<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Village ‚Äî Affichage noms b√¢timents</title>
  <style>
    :root {
      --ui: #ffffff;
      --ui-shadow: rgba(0,0,0,.35);
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: "Courier New", monospace;
      background: #0d0d0f;
      color: #dcdcdc;
    }

    /* --- √âcran secret --- */
    #lockscreen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at center, #1a1a20 0%, #000 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    #lockscreen h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(255,255,255,.25);
    }
    #lockscreen p {
      margin-bottom: 1rem;
      font-size: 1rem;
      opacity: .85;
    }
    #lockscreen input {
      padding: 10px 14px;
      border: 1px solid #444;
      border-radius: 6px;
      background: #111;
      color: #eee;
      font-family: inherit;
      font-size: 1rem;
      letter-spacing: 1px;
      outline: none;
      box-shadow: 0 0 12px rgba(0,255,150,.3);
      text-align: center;
    }
    #lockscreen button {
      margin-top: 1rem;
      padding: 10px 20px;
      background: #111;
      border: 1px solid #0f0;
      color: #0f0;
      font-family: inherit;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all .2s;
    }
    #lockscreen button:hover {
      background: #0f0;
      color: #000;
    }
    #error {
      margin-top: 1rem;
      color: #f55;
      display: none;
    }

    /* --- Map village --- */
    .wrap { display: none; place-items: center; height: 100%; }
    canvas {
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,.35), inset 0 0 0 2px rgba(255,255,255,.08);
      max-width: 96vw;
      max-height: 92vh;
    }
    .hud {
      position: fixed; inset: 16px auto auto 16px; color: var(--ui);
      text-shadow: 0 2px 6px var(--ui-shadow);
      user-select: none; font-size: 14px; line-height: 1.25;
    }
    .hud kbd {
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.35);
      padding: 2px 6px; border-radius: 6px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
      margin-right: 4px;
    }
    .prompt {
      position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%);
      color: var(--ui); font-weight: 600; letter-spacing: .2px;
      padding: 8px 12px; border-radius: 10px;
      background: rgba(0,0,0,.55); border: 1px solid rgba(255,255,255,.35);
      display: none; white-space: nowrap; text-shadow: 0 2px 6px var(--ui-shadow);
    }
  </style>
</head>
<body>
  <!-- √âcran secret -->
  <div id="lockscreen">
    <h1>üîé Syst√®me de V√©rification</h1>
    <p>Entrez le mot de passe pour acc√©der √† Naos :</p>
    <input type="password" id="code" placeholder="Mot de passe" aria-label="Mot de passe" />
    <button id="enterBtn">Entrer</button>
    <div id="error">‚ùå Code incorrect...</div>
  </div>

  <!-- Village -->
  <div class="wrap">
    <canvas id="game" width="960" height="600" aria-label="Village circulaire"></canvas>
  </div>
  <div class="hud" aria-hidden="true">
    <div><strong>D√©placements</strong> <kbd>Z</kbd><kbd>Q</kbd><kbd>S</kbd><kbd>D</kbd> ou <kbd>Fl√®ches</kbd></div>
  </div>
  <div id="prompt" class="prompt" role="status" aria-live="polite"></div>

  <script>
  // --- √âcran secret ---
  function checkCode() {
    const input = document.getElementById("code").value.trim();
    const errorEl = document.getElementById('error');
    if (input === "Noctambule") {
      document.getElementById("lockscreen").style.display = "none";
      document.querySelector(".wrap").style.display = "grid";
      errorEl.style.display = 'none';
    } else {
      errorEl.style.display = "block";
    }
  }
  document.getElementById('enterBtn').addEventListener('click', checkCode);
  document.getElementById('code').addEventListener('keydown', e => { if (e.key === 'Enter') checkCode(); });

  // --- Config ---
  const CONFIG = {
    world: { width: 960, height: 600 },
    center: { x: 480, y: 300 },
    circleRadius: 170,
    houseCount: 9,
    house: { size: 80 },
    player: {
      size: 32,
      color: '#ffd166',
      outline: 'rgba(0,0,0,.45)',
      speed: 2.6,
      start: { x: 480, y: 300 },
      image: "http://www.image-heberg.fr/files/17570217122216427613.png"
    },
    names: {
      1: "Biblioth√®que",
      2: "Salle de musique",
      3: "Galerie d‚Äôimages",
      4: "Cin√©ma",
      5: "Salle de r√©union",
      6: "Salle de jeux",
      7: "Bureau de philosophie",
      8: "Laboratoire",
      9: "Atelier d‚Äôart"
    }
  };

  const HOUSE_IMAGES = [
    "http://www.image-heberg.fr/files/1756932846977872901.png",
    "http://www.image-heberg.fr/files/17569327082239331138.png",
    "http://www.image-heberg.fr/files/17569329301273083581.png",
    "http://www.image-heberg.fr/files/17569325061444124555.png",
    "http://www.image-heberg.fr/files/17569293553633849300.png",
    "http://www.image-heberg.fr/files/17569333324150026336.png",
    "http://www.image-heberg.fr/files/17569320932872336291.png",
    "http://www.image-heberg.fr/files/17569316144126423008.png",
    "http://www.image-heberg.fr/files/17570037951807174458.png"
  ];

  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = "high";

  const background = new Image();
  background.src = "http://www.image-heberg.fr/files/17570213431743313302.png";

  const playerImg = new Image();
  playerImg.src = CONFIG.player.image;
  const player = {x:CONFIG.player.start.x,y:CONFIG.player.start.y,r:CONFIG.player.size};

  const TAU = Math.PI * 2;
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
  function generateHouses(){
    const houses=[];
    const {x:cx,y:cy}=CONFIG.center;
    const r=CONFIG.circleRadius;
    for(let i=0;i<CONFIG.houseCount;i++){
      const angle=(i/CONFIG.houseCount)*TAU - Math.PI/2;
      const hx=cx+Math.cos(angle)*r;
      const hy=cy+Math.sin(angle)*r;
      const img=new Image();
      img.src=HOUSE_IMAGES[i % HOUSE_IMAGES.length];
      houses.push({id:i+1,x:hx,y:hy,w:CONFIG.house.size,h:CONFIG.house.size,img});
    }
    return houses;
  }
  const HOUSES = generateHouses();

  const keys = new Set();
  window.addEventListener('keydown', e => {
    const k = e.key.toLowerCase();
    const movementKeys = ['z','q','s','d','arrowup','arrowdown','arrowleft','arrowright'];
    if(movementKeys.includes(k)) e.preventDefault();
    keys.add(k);
  });
  window.addEventListener('keyup', e => keys.delete(e.key.toLowerCase()));

  function tryMove(px,py){
    let dx=0,dy=0;
    if(keys.has('z')||keys.has('arrowup')) dy-=1;
    if(keys.has('s')||keys.has('arrowdown')) dy+=1;
    if(keys.has('q')||keys.has('arrowleft')) dx-=1;
    if(keys.has('d')||keys.has('arrowright')) dx+=1;
    const len=Math.hypot(dx,dy)||1;
    dx=dx/len*CONFIG.player.speed;
    dy=dy/len*CONFIG.player.speed;
    return {x:clamp(px+dx,player.r,CONFIG.world.width-player.r),
            y:clamp(py+dy,player.r,CONFIG.world.height-player.r)};
  }

  function drawHouse(h){
    if(h.img.complete){
      const aspect = h.img.width / h.img.height;
      let drawW, drawH;
      if(aspect >= 1){
        drawW = h.w;
        drawH = h.w / aspect;
      } else {
        drawH = h.h;
        drawW = h.h * aspect;
      }
      ctx.drawImage(h.img, h.x-drawW/2, h.y-drawH/2, drawW, drawH);
    }
  }

  function drawPlayer(){
    if (playerImg.complete && playerImg.naturalWidth > 0) {
      ctx.drawImage(playerImg, player.x-player.r, player.y-player.r, player.r*2, player.r*2);
    } else {
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.r, 0, TAU);
      ctx.fillStyle = CONFIG.player.color; ctx.fill();
      ctx.lineWidth = 2; ctx.strokeStyle = CONFIG.player.outline; ctx.stroke();
    }
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(background.complete) ctx.drawImage(background,0,0,canvas.width,canvas.height);
    for(const h of HOUSES) drawHouse(h);
    drawPlayer();
  }

  function getNearbyHouse(){
    let nearest=null, bestDist=Infinity;
    for(const h of HOUSES){
      const dist=Math.hypot(player.x-h.x,player.y-h.y);
      if(dist<bestDist){ bestDist=dist; nearest=h; }
    }
    if(bestDist < CONFIG.house.size * 0.6) return nearest;
    return null;
  }

  const promptEl = document.getElementById("prompt");
  function updatePrompt(){
    const h=getNearbyHouse();
    if(h && CONFIG.names[h.id]){
      promptEl.style.display='block';
      promptEl.textContent = CONFIG.names[h.id];
    } else {
      promptEl.style.display='none';
    }
  }

  function loop(){
    const next=tryMove(player.x,player.y);
    player.x=next.x; player.y=next.y;
    draw(); updatePrompt();
    requestAnimationFrame(loop);
  }
  loop();
  </script>
</body>
</html>
