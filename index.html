<script>
  // --- Écran secret ---
  function checkCode(){
    const input=document.getElementById("code").value.trim();
    if(input==="Noctambule"){
      document.getElementById("lockscreen").style.display="none";
      document.querySelector(".wrap").style.display="grid";
    } else {
      document.getElementById("error").style.display="block";
    }
  }

  // --- Village ---
  const CONFIG = {
    world: { width: 960, height: 600 },
    center: { x: 480, y: 300 },
    circleRadius: 200,
    houseCount: 9,   // ✅ On passe à 9 maisons
    house: { size: 80 },
    player: {
      size: 16, color: '#ffd166',
      outline: 'rgba(0,0,0,.45)',
      speed: 2.6,
      start: { x: 480, y: 300 },
    },
    links: { map: {
      1: "docs/maison1.pdf",
      2: "Musique$=.png",
      3: "Image1.jpg",
      4: "film.png",
      5: "Power Point Ultime +.pdf",
      6: "jeu.png",
      7: "Philosophie (version 1) (version 1).xlsx",
      8: "docs/maison8.xlsx",
      9: "docs/maison9.pdf"   // ✅ Nouveau lien pour ta 9ᵉ maison
    }}
  };

  const HOUSE_IMAGES = [
    "http://www.image-heberg.fr/files/1756932846977872901.png",
    "http://www.image-heberg.fr/files/17569327082239331138.png",
    "http://www.image-heberg.fr/files/17569329301273083581.png",
    "http://www.image-heberg.fr/files/17569325061444124555.png",
    "http://www.image-heberg.fr/files/17569293553633849300.png",
    "http://www.image-heberg.fr/files/17569333324150026336.png",
    "http://www.image-heberg.fr/files/17569320932872336291.png",
    "http://www.image-heberg.fr/files/17569316144126423008.png",
    "http://www.image-heberg.fr/files/17569335000000000000.png" // ✅ Ajoute ton image de maison9 ici
  ];

</script>


  const canvas=document.getElementById('game');
  const ctx=canvas.getContext('2d');
  const prompt=document.getElementById("prompt");
  const TAU=Math.PI*2;
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  function generateHouses(){
    const houses=[];
    const {x:cx,y:cy}=CONFIG.center;
    const r=CONFIG.circleRadius;
    for(let i=0;i<CONFIG.houseCount;i++){
      const angle=(i/CONFIG.houseCount)*TAU - Math.PI/2;
      const hx=cx+Math.cos(angle)*r;
      const hy=cy+Math.sin(angle)*r;
      houses.push({id:i+1,x:hx,y:hy,w:CONFIG.house.size,h:CONFIG.house.size,img:new Image()});
      houses[i].img.src=HOUSE_IMAGES[i%HOUSE_IMAGES.length];
    }
    return houses;
  }

  const HOUSES=generateHouses();
  const keys=new Set();
  window.addEventListener('keydown',e=>keys.add(e.key.toLowerCase()));
  window.addEventListener('keyup',e=>keys.delete(e.key.toLowerCase()));

  const player={x:CONFIG.player.start.x,y:CONFIG.player.start.y,r:CONFIG.player.size};

  function tryMove(px,py){
    let dx=0,dy=0;
    if(keys.has('z')||keys.has('arrowup')) dy-=1;
    if(keys.has('s')||keys.has('arrowdown')) dy+=1;
    if(keys.has('q')||keys.has('arrowleft')) dx-=1;
    if(keys.has('d')||keys.has('arrowright')) dx+=1;
    const len=Math.hypot(dx,dy)||1;
    dx=dx/len*CONFIG.player.speed;
    dy=dy/len*CONFIG.player.speed;
    return {x:clamp(px+dx,player.r,CONFIG.world.width-player.r), y:clamp(py+dy,player.r,CONFIG.world.height-player.r)};
  }

  function drawHouse(h){ ctx.drawImage(h.img,h.x-h.w/2,h.y-h.h/2,h.w,h.h); }
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(const h of HOUSES) drawHouse(h);
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.r,0,TAU);
    ctx.fillStyle=CONFIG.player.color; ctx.fill();
    ctx.lineWidth=2; ctx.strokeStyle=CONFIG.player.outline; ctx.stroke();
  }

  function getNearbyHouse(){
    for(const h of HOUSES){
      const dist=Math.hypot(player.x-h.x,player.y-h.y);
      if(dist<CONFIG.house.size*0.6) return h;
    }
    return null;
  }
  function updatePrompt(){
    const h=getNearbyHouse();
    prompt.style.display=(h&&CONFIG.links.map[h.id])?"block":"none";
  }

  window.addEventListener("keydown",e=>{
    if(e.key.toLowerCase()==="e"){
      const h=getNearbyHouse();
      if(h&&CONFIG.links.map[h.id]) window.location.href=CONFIG.links.map[h.id];
    }
  });

  function loop(){
    const next=tryMove(player.x,player.y);
    player.x=next.x; player.y=next.y;
    draw(); updatePrompt();
    requestAnimationFrame(loop);
  }
  loop();
  </script>
</body>
</html>
