<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Acc√®s Bloqu√© ‚Äî Village (HD, pas de d√©formation)</title>
  <style>
    :root {
      --ui: #ffffff;
      --ui-shadow: rgba(0,0,0,.35);
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: "Courier New", monospace;
      background: #0d0d0f;
      color: #dcdcdc;
    }
    #lockscreen {
      position: fixed; inset: 0;
      background: radial-gradient(circle at center, #1a1a20 0%, #000 100%);
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      text-align: center;
    }
    #lockscreen h1 { font-size: 2rem; margin-bottom: 1rem; }
    #lockscreen p { margin-bottom: 1rem; }
    #lockscreen input {
      padding: 10px 14px;
      border: 1px solid #444; border-radius: 6px;
      background: #111; color: #eee;
      font-family: inherit; font-size: 1rem;
      text-align: center;
    }
    #lockscreen button {
      margin-top: 1rem; padding: 10px 20px;
      background: #111; border: 1px solid #0f0; color: #0f0;
      border-radius: 6px; cursor: pointer;
    }
    #error { margin-top: 1rem; color: #f55; display: none; }

    .wrap { display: none; place-items: center; height: 100%; }
    canvas {
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
      max-width: 96vw; max-height: 92vh;
    }
    .hud {
      position: fixed; left: 16px; top: 16px;
      color: var(--ui); text-shadow: 0 2px 6px var(--ui-shadow);
      font-size: 14px;
    }
    .hud kbd {
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.35);
      padding: 2px 6px; border-radius: 6px;
      margin-right: 4px;
    }
    .prompt {
      position: fixed; left: 50%; bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.35);
      padding: 8px 12px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,.35);
      display: none;
    }
  </style>
</head>
<body>
  <div id="lockscreen">
    <h1>üîé Syst√®me de V√©rification</h1>
    <p>Entrez le mot de passe pour acc√©der √† Naos :</p>
    <input type="password" id="code" placeholder="Mot de passe" />
    <button id="enterBtn">Entrer</button>
    <div id="error">‚ùå Code incorrect...</div>
  </div>

  <div class="wrap">
    <canvas id="game" width="960" height="600"></canvas>
  </div>
  <div class="hud">
    <div><kbd>ZQSD</kbd> ou <kbd>Fl√®ches</kbd> pour bouger</div>
    <div><kbd>E</kbd> pour entrer dans une maison</div>
  </div>
  <div id="prompt" class="prompt">Appuyez sur <kbd>E</kbd> pour entrer</div>

  <script>
  // --- V√©rification du mot de passe ---
  function checkCode() {
    const input = document.getElementById("code").value.trim();
    const errorEl = document.getElementById('error');
    if (input === "Noctambule") {
      document.getElementById("lockscreen").style.display = "none";
      document.querySelector(".wrap").style.display = "grid";
      errorEl.style.display = 'none';
    } else {
      errorEl.style.display = "block";
    }
  }
  document.getElementById('enterBtn').addEventListener('click', checkCode);
  document.getElementById('code').addEventListener('keydown', e => { if (e.key === 'Enter') checkCode(); });

  // --- Config ---
  const CONFIG = {
    world: { width: 960, height: 600 },
    center: { x: 480, y: 300 },
    circleRadius: 170,
    houseCount: 9,
    house: { maxSize: 80 },
    player: {
      size: 48,
      speed: 2.6,
      start: { x: 480, y: 300 },
      image: "http://www.image-heberg.fr/files/17570217122216427613.png"
    },
    links: { map: {
      1: "http://www.image-heberg.fr/files/17570045253321247512.png",
      2: "Musique$=.png",
      3: "Image1.jpg",
      4: "Film.pdf",
      5: "Power Point Ultime +.pdf",
      6: "jeu.png",
      7: "Philosophie (version 1) (version 1).xlsx",
      8: "map2.html",
      9: "http://www.image-heberg.fr/files/17570018873343452500.png"
    }},
    names: {
      1: "Agence de Voyage",
      2: "Boite de Nuit",
      3: "Boutique de v√™tements",
      4: "Cin√©ma",
      5: "Maison du D√©tective",
      6: "Salle de jeux",
      7: "Centre d'archive",
      8: "Mus√©e des Domus",
      9: "M√©diath√®que"
    }
  };

  const HOUSE_IMAGES = [
    "http://www.image-heberg.fr/files/1756932846977872901.png",
    "http://www.image-heberg.fr/files/17569327082239331138.png",
    "http://www.image-heberg.fr/files/17569329301273083581.png",
    "http://www.image-heberg.fr/files/17569325061444124555.png",
    "http://www.image-heberg.fr/files/17569293553633849300.png",
    "http://www.image-heberg.fr/files/17569333324150026336.png",
    "http://www.image-heberg.fr/files/17569320932872336291.png",
    "http://www.image-heberg.fr/files/17569316144126423008.png",
    "http://www.image-heberg.fr/files/17570037951807174458.png"
  ];

  // --- Canvas HiDPI ---
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  canvas.width = CONFIG.world.width * dpr;
  canvas.height = CONFIG.world.height * dpr;
  canvas.style.width = CONFIG.world.width + "px";
  canvas.style.height = CONFIG.world.height + "px";
  ctx.scale(dpr, dpr);
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = "high";

  // --- Fond ---
  const background = new Image();
  background.src = "http://www.image-heberg.fr/files/17570213431743313302.png";

  // --- Joueur ---
  const playerImg = new Image();
  playerImg.src = CONFIG.player.image;
  const player = {x:CONFIG.player.start.x,y:CONFIG.player.start.y};

  // --- Maisons ---
  const TAU = Math.PI * 2;
  function generateHouses(){
    const houses=[];
    for(let i=0;i<CONFIG.houseCount;i++){
      const angle=(i/CONFIG.houseCount)*TAU - Math.PI/2;
      const hx=CONFIG.center.x+Math.cos(angle)*CONFIG.circleRadius;
      const hy=CONFIG.center.y+Math.sin(angle)*CONFIG.circleRadius;
      const img=new Image();
      img.src=HOUSE_IMAGES[i % HOUSE_IMAGES.length];
      houses.push({id:i+1,x:hx,y:hy,img});
    }
    return houses;
  }
  const HOUSES = generateHouses();

  // --- Contr√¥les ---
  const keys = new Set();
  window.addEventListener('keydown', e => keys.add(e.key.toLowerCase()));
  window.addEventListener('keyup', e => keys.delete(e.key.toLowerCase()));

  function tryMove(px,py){
    let dx=0,dy=0;
    if(keys.has('z')||keys.has('arrowup')) dy-=1;
    if(keys.has('s')||keys.has('arrowdown')) dy+=1;
    if(keys.has('q')||keys.has('arrowleft')) dx-=1;
    if(keys.has('d')||keys.has('arrowright')) dx+=1;
    const len=Math.hypot(dx,dy)||1;
    dx=dx/len*CONFIG.player.speed;
    dy=dy/len*CONFIG.player.speed;
    return {x:px+dx,y:py+dy};
  }

  function drawImageKeepRatio(img, cx, cy, maxW, maxH){
    const iw=img.naturalWidth, ih=img.naturalHeight;
    if(!iw||!ih) return;
    const scale=Math.min(maxW/iw, maxH/ih);
    const w=iw*scale, h=ih*scale;
    ctx.drawImage(img, cx-w/2, cy-h/2, w, h);
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(background.complete) {
      drawImageKeepRatio(background, CONFIG.world.width/2, CONFIG.world.height/2,
                         CONFIG.world.width, CONFIG.world.height);
    }
    for(const h of HOUSES){
      if(h.img.complete) drawImageKeepRatio(h.img, h.x, h.y, CONFIG.house.maxSize, CONFIG.house.maxSize);
    }
    if(playerImg.complete) {
      drawImageKeepRatio(playerImg, player.x, player.y, CONFIG.player.size, CONFIG.player.size);
    }
  }

  function getNearbyHouse(){
    let nearest=null, bestDist=Infinity;
    for(const h of HOUSES){
      const dist=Math.hypot(player.x-h.x,player.y-h.y);
      if(dist<bestDist){ bestDist=dist; nearest=h; }
    }
    if(bestDist < CONFIG.house.maxSize * 0.6) return nearest;
    return null;
  }

  const promptEl = document.getElementById("prompt");
  function updatePrompt(){
    const h=getNearbyHouse();
    if(h && CONFIG.links.map[h.id]){
      promptEl.style.display='block';
      promptEl.textContent = CONFIG.names[h.id] || "B√¢timent";
    } else {
      promptEl.style.display='none';
    }
  }

  window.addEventListener("keydown", e=>{
    if(e.key.toLowerCase()==="e"){
      const h=getNearbyHouse();
      if(h && CONFIG.links.map[h.id]){
        if(h.id === 8) window.location.href = CONFIG.links.map[8];
        else window.open(CONFIG.links.map[h.id], "_blank");
      }
    }
  });

  function loop(){
    const next=tryMove(player.x,player.y);
    player.x=next.x; player.y=next.y;
    draw(); updatePrompt();
    requestAnimationFrame(loop);
  }
  loop();
  </script>
</body>
</html>
